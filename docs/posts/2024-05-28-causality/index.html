<!DOCTYPE html>


<html lang="en-us" data-theme="">
<head>
    
        
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer-when-downgrade">

<title>Causality Introduction - Bingz Learning Blog</title>

<meta name="description" content="An introduction to causality inference">





<link rel="icon" type="image/x-icon" href="https://bingzw.github.io/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="https://bingzw.github.io/favicon.png">






    



    



<style>
  body {
    visibility: hidden;
    opacity: 0;
  }
</style>

<noscript>
  <style>
    body {
      visibility: visible;
      opacity: 1;
    }
  </style>
</noscript>




    





    
    
        
    
    

    
        <link rel="stylesheet" href="/css/style.min.184a655c5ad8596648622468e6696abf0cf0a2cf8266df17b4f7a36fe9c97551.css" integrity="sha256-GEplXFrYWWZIYiRo5mlqvwzwos&#43;CZt8XtPejb&#43;nJdVE=">
    





    





    
    
        
    
    

    
        <link rel="stylesheet" href="/css/style.min.c4c04b3ef88e3d619ad4c7ee5e03048422bc55c4fefdc1f07657c1133670aa22.css" integrity="sha256-xMBLPviOPWGa1MfuXgMEhCK8VcT&#43;/cHwdlfBEzZwqiI=">
    





    





    
    
        
    
    

    
        <link rel="stylesheet" href="/css/style.min.21c5d8fe0a79d623b0adc1ce4bd4f6dd2c05cd939c9aaaa966ba7186b1464f4d.css" integrity="sha256-IcXY/gp51iOwrcHOS9T23SwFzZOcmqqpZrpxhrFGT00=">
    












    

    





    
    
        
    
    

    
        <script src="/js/script.min.08f04d96386c73c9bf4d160333f8f448c05a6e01c06770542ee0e013954ce930.js" type="text/javascript" charset="utf-8" integrity="sha256-CPBNljhsc8m/TRYDM/j0SMBabgHAZ3BULuDgE5VM6TA="></script>
    













    
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-3P52NT65ZQ"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-3P52NT65ZQ');
        }
      </script>
    
  









    
</head>
<body>
    <a class="skip-main" href="#main">Skip to main content</a>
    <div class="container">
        <header class="common-header">
            
                <div class="header-top">
    <div class="header-top-left">
        <h1 class="site-title noselect">
    <a href="/">Bingz Learning Blog</a>
</h1>

        



    



    



    
        <div class="theme-switcher">
            <span class="inline-svg">

    


    
    
    
    
    

    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-sun-high"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z" /><path d="M6.343 17.657l-1.414 1.414" /><path d="M6.343 6.343l-1.414 -1.414" /><path d="M17.657 6.343l1.414 -1.414" /><path d="M17.657 17.657l1.414 1.414" /><path d="M4 12h-2" /><path d="M12 4v-2" /><path d="M20 12h2" /><path d="M12 20v2" /></svg>


</span>

        </div>
    

    <script>
        const STORAGE_KEY = 'user-color-scheme'
        const defaultTheme = "auto"

        let currentTheme
        let switchButton
        let autoDefinedScheme = window.matchMedia('(prefers-color-scheme: dark)')

        function switchTheme(e) {
            currentTheme = (currentTheme === 'dark') ? 'light' : 'dark';
            if (localStorage) localStorage.setItem(STORAGE_KEY, currentTheme);
            document.documentElement.setAttribute('data-theme', currentTheme);
            changeGiscusTheme(currentTheme);
            document.body.dispatchEvent(new CustomEvent(currentTheme + "-theme-set"));
        }

        const autoChangeScheme = e => {
            currentTheme = e.matches ? 'dark' : 'light'
            document.documentElement.setAttribute('data-theme', currentTheme);
            changeGiscusTheme(currentTheme);
            document.body.dispatchEvent(new CustomEvent(currentTheme + "-theme-set"));
        }

        document.addEventListener('DOMContentLoaded', function () {
            switchButton = document.querySelector('.theme-switcher')
            currentTheme = detectCurrentScheme()

            if (currentTheme === 'auto') {
                autoChangeScheme(autoDefinedScheme);
                autoDefinedScheme.addListener(autoChangeScheme);
            } else {
                document.documentElement.setAttribute('data-theme', currentTheme)
            }

            if (switchButton) {
                switchButton.addEventListener('click', switchTheme, false)
            }

            showContent();
        })

        function detectCurrentScheme() {
            if (localStorage !== null && localStorage.getItem(STORAGE_KEY)) {
                return localStorage.getItem(STORAGE_KEY)
            }
            if (defaultTheme) {
                return defaultTheme
            }
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function showContent() {
            document.body.style.visibility = 'visible';
            document.body.style.opacity = 1;
        }

        function changeGiscusTheme (theme) {
            function sendMessage(message) {
              const iframe = document.querySelector('iframe.giscus-frame');
              if (!iframe) return;
              iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
            }

            sendMessage({
              setConfig: {
                theme: theme
              }
            });
        }
    </script>


        <ul class="social-icons noselect">


    
        
        
        <li>
            <a href="https://github.com/bingzw" title="Github" rel="me">
            <span class="inline-svg">

    


    
    
    
    
    

    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-github"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" /></svg>


</span>

            </a>
        </li>
    

    
        <li>
            <a href="https://www.linkedin.com/in/bingzw/" title="Linkedin" rel="me">
            <span class="inline-svg">

    


    
    
    
    
    

    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z" /><path d="M8 11l0 5" /><path d="M8 8l0 .01" /><path d="M12 16l0 -5" /><path d="M16 16v-3a2 2 0 0 0 -4 0" /></svg>


</span>

            </a>
        </li>
    






    <li>
            <a href="/index.xml" title="RSS" rel="me">
            <span class="inline-svg">

    


    
    
    
    
    

    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M4 4a16 16 0 0 1 16 16" /><path d="M4 11a9 9 0 0 1 9 9" /></svg>


</span>

            </a>
        </li>
    

</ul>

    </div>
    <div class="header-top-right">

    </div>
</div>


    <nav class="noselect">
        
        
        <a class="" href="https://bingzw.github.io/" title="">Home</a>
        
        <a class="" href="https://bingzw.github.io/about/" title="">About</a>
        
        <a class="" href="https://bingzw.github.io/tags/" title="">Tags</a>
        
        <a class="" href="https://bingzw.github.io/posts/" title="">Archive</a>
        
    </nav>



<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>





            
        </header>
        <main id="main" tabindex="-1">
            
    

    <article class="post h-entry">
        <div class="post-header">
            <header>
                <h1 class="p-name post-title">Causality Introduction</h1>
                

            </header>
            



<div class="post-info noselect">
    
        <div class="post-date dt-published">
            <time datetime="2024-05-28">2024-05-28</time>
            
        </div>
    

    <a class="post-hidden-url u-url" href="/posts/2024-05-28-causality/">/posts/2024-05-28-causality/</a>
    <a href="https://bingzw.github.io/" class="p-name p-author post-hidden-author h-card" rel="me"></a>


    <div class="post-taxonomies">
        
        
            <ul class="post-tags">
                
                    
                    <li><a href="/tags/causal-inference/">#Causal Inference</a></li>
                
                    
                    <li><a href="/tags/statistics/">#Statistics</a></li>
                
            </ul>
        
        
    </div>
</div>

        </div>
        

  
  




  
  
  
  <details class="toc noselect">
    <summary>Table of Contents</summary>
    <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-causality">What Is Causality?</a>
      <ul>
        <li><a href="#causal-formulation">Causal Formulation</a></li>
        <li><a href="#average-treatment-effect">Average Treatment Effect</a></li>
      </ul>
    </li>
    <li><a href="#causal-effect-estimation">Causal Effect Estimation</a>
      <ul>
        <li><a href="#randomized-controlled-trials-ab-testing">Randomized Controlled Trials (A/B Testing)</a></li>
        <li><a href="#causal-inference---confounder-adjustments-methods">Causal Inference - Confounder Adjustments Methods</a>
          <ul>
            <li><a href="#key-assumptions">Key Assumptions</a></li>
            <li><a href="#general-flow-of-causal-inference">General Flow of Causal Inference</a></li>
            <li><a href="#inverse-probability-weighting">Inverse Probability Weighting</a></li>
            <li><a href="#standardization">Standardization</a></li>
            <li><a href="#stratification">Stratification</a></li>
            <li><a href="#propensity-score-matching">Propensity Score Matching</a></li>
            <li><a href="#double-machine-learning-dml">Double Machine Learning (DML)</a></li>
          </ul>
        </li>
        <li><a href="#causal-inference---instrumental-variables">Causal Inference - Instrumental Variables</a></li>
      </ul>
    </li>
    <li><a href="#root-cause-optimization">Root Cause Optimization</a></li>
    <li><a href="#appendix">Appendix</a>
      <ul>
        <li><a href="#do-calculus">Do Calculus</a></li>
      </ul>
    </li>
    <li><a href="#citation">Citation</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav></div>
  </details>
  



<script>
  var toc = document.querySelector(".toc");
  if (toc) {
    toc.addEventListener("click", function () {
      if (event.target.tagName !== "A") {
        event.preventDefault();
        if (this.open) {
          this.open = false;
          this.classList.remove("expanded");
        } else {
          this.open = true;
          this.classList.add("expanded");
        }
      }
    });
  }
</script>

        <div class="content e-content">
            <p><img src="/causality/causality_icon.png" alt="causality_icon"></p>
<h2 id="what-is-causality" >
<div>
    <a href="#what-is-causality">
        #
    </a>
    What Is Causality?
</div>
</h2>
<p>Different from common ML tasks that focus on summarizing the patterns in the data, expecting to make predictions on
similar unseen data. Causality, on the other hand, is about understanding the underlying mechanisms that drive the data.
It is about to predict how the people/agent/system would react if it were intervened in a certain way. Think about the
example of having two parallel universes with different light, temperature, and humidity conditions. What would happen
to a plant if it were moved from one universe to another? This is a causal question.</p>
<h3 id="causal-formulation" >
<div>
    <a href="#causal-formulation">
        ##
    </a>
    Causal Formulation
</div>
</h3>
<p>To understand how the outcome would change in different conditions, we need to define the following notations to
describe the causal relations.</p>
<ul>
<li>$Y_i$: the outcome of interest for individual $i$. For example, the health status of a patient.</li>
<li>$A_i$: an indicator of whether the individual $i$ received the treatment. For example, a new drug.</li>
<li>$X_i$: a set of covariates that may affect both the treatment assignment and the outcome. For example, health status,
age, gender etc</li>
<li>$U_i$: unobserved factors that may affect both the treatment assignment and the outcome. For example, genetic factors.</li>
<li>$Y_i^{a}$: the potential outcome of individual $i$ if he/she received the treatment $A = a, a \in \{0, 1\}$. For
example, the health status of a patient if he/she received the new drug ($a=1$).</li>
</ul>
<p>In practice, the data $(Y_i, A_i, X_i)$ is usually drawn i.i.d from a population and they are formulated into a causal
graph as shown below<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</p>
<p align="center">
    <img src="/causality/causal_model_diagram.png" width="600" height="400"><br>
    <em>Figure 1: causal inference elements</em>
</p>
<p>The mechanism of the causal graph is often reasoning by structural causal models (SCM). It models the underlying data
generation process with an ordered sequence of functions that map the parent nodes to the child nodes. For example, the
SCMs of the above causal graph can be written as:
$P(Y, A, X) = P(Y | A, X) P(X | A) P(A)$. This equation describes the probabilistic dependencies between the observed
variables. Now the question is how do we define the effect of the new drug $A$ on health outcome $Y$?</p>
<h3 id="average-treatment-effect" >
<div>
    <a href="#average-treatment-effect">
        ##
    </a>
    Average Treatment Effect
</div>
</h3>
<p>Let&rsquo;s continue with the above drug trail context and notations. Consider a simple case with a binary treatment $A$
(1: treated, 0: untreated) and a binary outcome $Y$ (1: recovered, 0: not recovered).</p>
<ul>
<li>$Y^{a=1}$ (Y under the treatment
a = 1) be the outcome variable that would have been observed if the patient had received the treatment.</li>
<li>$Y^{a=0}$ (Y
under the treatment a = 0) be the outcome variable that would have been observed if the patient had not received the
treatment.</li>
</ul>
<p>When estimating the causal effect on the <strong>population</strong>, it&rsquo;s usually to consider the average treatment effect (ATE),
$ATE = E[Y^{a=1}] - E[Y^{a=0}]$, denoting the average causal effect of the treatment on the outcome.</p>
<h2 id="causal-effect-estimation" >
<div>
    <a href="#causal-effect-estimation">
        #
    </a>
    Causal Effect Estimation
</div>
</h2>
<p>With the causal formulation and the average treatment effect defined, the next step is to estimate the causal effect
from the observed data. Multiple methods have been developed for this purpose, each relying on different assumptions
and is suitable for different scenarios. Some of the most common methods include: <em>randomized controlled trials (A/B
testing)</em>, <em>confounder adjustments methods</em>, <em>instrumental variables</em>, and <em>difference-in-differences</em> etc.</p>
<h3 id="randomized-controlled-trials-ab-testing" >
<div>
    <a href="#randomized-controlled-trials-ab-testing">
        ##
    </a>
    Randomized Controlled Trials (A/B Testing)
</div>
</h3>
<p>The most common approach to estimate the causal effect is to run an experiment, usually in the following general steps.</p>
<ol>
<li>Objective: Define the research question and the hypothesis (usually built with treatment metrics) to be tested.</li>
<li>Design: Randomly assign the subjects into two groups, the treatment group (A) and the control group (B). The
treatment group receives the treatment, while the control group does not.</li>
<li>Randomization: Randomly assign the subjects to the treatment and control groups to ensure the groups are comparable.</li>
<li>Run test: Implement the A/B test and let it run for a sufficient period to gather an adequate amount of data</li>
<li>Analysis: Analyze the data and calculate the treatment effect.</li>
<li>Decisions: Make decisions based on the test results.</li>
</ol>
<p>Randomized controlled trials are considered the gold standard for causal inference because they can eliminate the
confounding bias by randomizing the treatment assignment. However, they are not always feasible due to ethical,
practical, or financial reasons. Therefore, other methods are developed to estimate the causal effect from observational
data.</p>
<h3 id="causal-inference---confounder-adjustments-methods" >
<div>
    <a href="#causal-inference---confounder-adjustments-methods">
        ##
    </a>
    Causal Inference - Confounder Adjustments Methods
</div>
</h3>
<p>Before diving into the confounder adjustments methods, let&rsquo;s first clarify the confounding bias. Consider the following
example:</p>
<p align="center">
    <img src="/causality/confounder_selection_bias.png"><br>
    <em>Figure 2: confounder example</em>
</p>
<p>A study is conducted to investigate the effect of a new drug on the health outcome of patients. The study
finds that patients who received the new drug have a higher recovery rate than those who did not. However, the study
also finds that the patients who received the new drug are younger and healthier than those who did not. Therefore, the
observed effect of the new drug on the health outcome may be <strong>confounded</strong> by the age and health status of the patients.
To estimate the causal effect of the new drug on the health outcome, we need to <em>adjust</em> for the confounding factors,
such as age and health status.</p>
<h4 id="key-assumptions" >
<div>
    <a href="#key-assumptions">
        ###
    </a>
    Key Assumptions
</div>
</h4>
<p>All the confounder adjustments methods rely on the following key assumptions:</p>
<ul>
<li><strong>Exchangeability</strong>: the treatment assignment is independent of the potential outcomes given the covariates.</li>
<li><strong>Positivity</strong>: the probability of receiving the treatment is positive for all levels of the covariates.</li>
<li><strong>Consistency</strong>: the individual&rsquo;s potential outcome is the same as the observed outcome when the treatment is received.</li>
</ul>
<h4 id="general-flow-of-causal-inference" >
<div>
    <a href="#general-flow-of-causal-inference">
        ###
    </a>
    General Flow of Causal Inference
</div>
</h4>
<p>In general, causal inference is to build a pseudo-population that mimics the randomized experimentation from the observed
data. The assumptions taken and the modeling approaches applied are to ensure the pseudo-population is unbiased and
consistent with the true population. The general flow of causal inference can be summarized as follows:</p>
<ol>
<li><strong>Define the Problem</strong>: What are the causal effect of interest? What are the treatment and outcome variables?</li>
<li><strong>Acquire Data</strong>: Collect the data that contains the treatment, outcome, and covariates.</li>
<li><strong>Build the Causal Model</strong>: Fit the causal model that describes the causal relationship</li>
<li><strong>Estimate the Causal Effect</strong>: Estimate the counterfactual causal effect using the trained model</li>
</ol>
<p align="center">
    <img src="/causality/causal_inference_flow.png" width="800" height="500"><br>
    <em>Figure 3: Causal Inference Modeling Flow</em>
</p>
We follow the same modeling process in figure 3. First defining the outcome, treatment, and covariates, then building the
causal model using the sample data. Next to estimate the counterfactual performance for both treated and untreated in the
treatment and control groups. The dashed figure in the above graph represents the unobserved counterfactuals that are 
estimated from the counterfactual model. Finally, the causal effect is then estimated by comparing the observed outcome 
with the estimated counterfactual outcome.
<p>Let&rsquo;s dive deep into how the causal model<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> can be trained from the observed data.</p>
<h4 id="inverse-probability-weighting" >
<div>
    <a href="#inverse-probability-weighting">
        ###
    </a>
    Inverse Probability Weighting
</div>
</h4>
<ul>
<li>Key Idea: Assigning weights to observations in order to create a pseudo-population that approximates the population
that would have been obtained through random assignment in a randomized control trial (RCT).</li>
<li>Steps:
<ol>
<li>Estimate the propensity score, $g(x) = P(A = 1 | X = x)$, the probability of receiving the treatment given the
covariates.</li>
<li>Calculate the inverse probability weights, $w_i = \frac{P(A_i)}{g(x_i)}$.</li>
<li>Fit a marginal structure model $E[Y^a] = \beta_0 + \beta_1 a$ with the inverse probability weights $w_i$.</li>
<li>Estimate the average treatment effect, $ATE = \hat{\beta_1}$.</li>
</ol>
</li>
</ul>
<h4 id="standardization" >
<div>
    <a href="#standardization">
        ###
    </a>
    Standardization
</div>
</h4>
<ul>
<li>Key Idea: Standardize the outcome under different treatment conditions to estimate the average treatment effect.</li>
<li>Steps:
<ol>
<li>Fit the outcome model with treatment and covariates, $P[Y^a | X=x] = P(Y | A=a, X=x)$. For example, the linear model
representation is $Y^A = \beta_0 + \beta_1 A + \beta_2 X + \epsilon$.</li>
<li>Estimate the expectation of the outcome under different treatment conditions:
$E[Y^a] = \int_x P(Y|A=a, x)*f_X(x)dx$.</li>
<li>Calculate the average treatment effect, $ATE = E[Y^{a=1}] - E[Y^{a=0}]$.</li>
</ol>
</li>
</ul>
<h4 id="stratification" >
<div>
    <a href="#stratification">
        ###
    </a>
    Stratification
</div>
</h4>
<ul>
<li>Key Idea: Stratify the data into different strata based on the covariates and estimate the average treatment effect.</li>
<li>Steps:
<ol>
<li>Estimate the propensity score, $g(x) = P(A = 1 | X = x)$, the probability of receiving the treatment given the
covariates.</li>
<li>Fit the outcome model with treatment and propensity score as the covariates,
$P[Y^a | X=x] = P(Y | A=a, g(x))$. A simple linear representation is $Y^A = \beta_0 + \beta_1 A + \beta_2 * g(X) + \epsilon$.</li>
<li>Estimate the expectation of the outcome under different treatment conditions:
$E[Y^a] = \int_x P(Y|A=a, g(x))*f_X(x)dx$</li>
<li>Calculate the average treatment effect, $ATE = E[Y^{a=1}] - E[Y^{a=0}]$.</li>
</ol>
</li>
</ul>
<h4 id="propensity-score-matching" >
<div>
    <a href="#propensity-score-matching">
        ###
    </a>
    Propensity Score Matching
</div>
</h4>
<ul>
<li>Key Idea: Match the treated and control units based on the propensity score to estimate the average treatment effect.</li>
<li>Steps:
<ol>
<li>Estimate the propensity score, $g(x) = P(A = 1 | X = x)$, the probability of receiving the treatment given the
covariates.</li>
<li>Match the treated and control units based on the propensity score. (Nearest Neighbour, Kernel Matching, etc)</li>
<li>Estimate the average treatment effect, $ATE = E[Y^{a=1}] - E[Y^{a=0}]$.</li>
</ol>
</li>
</ul>
<h4 id="double-machine-learning-dml" >
<div>
    <a href="#double-machine-learning-dml">
        ###
    </a>
    Double Machine Learning (DML)
</div>
</h4>
<p>In all above methods, we have observed that two components are needed to estimate the causal effect: the propensity score
$g(x) = P(A = 1 | X = x)$ and the outcome model $P[Y^a | X=x] = P(Y | A=a, X=x)$. However, the estimation of these
components may be biased, leading to biased estimates of the causal effect. To address this issue, double machine learning
(DML) is proposed.</p>
<ul>
<li>Key Idea: Use machine learning algorithms to estimate the nuisance functions and statistical estimation techniques to
estimate the causal effect.</li>
<li>Steps:
<ol>
<li>Divide the data into K-folds (cross fitting). For each fold $i$, train the propensity score model and the outcome model on
folds other than $i$, i.e. $g^{-i}(x)$ and $P^{-i}(Y^a | X)$.</li>
<li>Estimating the augmented inverse probability of treatment weighted estimator (AIPTW) for fold $i$:
$\hat{\tau_i} = \frac{1}{n_i} \sum_{i} \hat{P}^{-i}(Y^{a=1} | x_i) - \hat{P}^{-i}(Y^{a=0} | x_i) + A_i\frac{Y_i - \hat{P}^{-i}(Y^{a=1} | x_i)}{\hat{g}^{-i}(x_i)} - (1-A_i)\frac{Y_i - \hat{P}^{-i}(Y^{a=0} | x_i)}{1-\hat{g}^{-i}(x_i)}$</li>
<li>Aggreagate the estimates from all folds to get the final estimate of the causal effect, $\hat{\tau} = \frac{1}{N} \sum_{i} n_i \hat{\tau_i}$.</li>
</ol>
</li>
</ul>
<h3 id="causal-inference---instrumental-variables" >
<div>
    <a href="#causal-inference---instrumental-variables">
        ##
    </a>
    Causal Inference - Instrumental Variables
</div>
</h3>
<p>All above approaches rely on the assumption of no unobserved confounding, which may not be satisfied in practice. When
there is potential endogeneity or unobserved confounding in observational data, instrumental variables can be used to
estimate the causal effect.</p>
<ul>
<li>Key Idea: Estimating the causal effect of a treatment or intervention when there is potential endogeneity or
unobserved confounding in observational data. It relies on the use of an instrumental variable, which is a variable
that is correlated with the treatment but not directly with the outcome, except through its influence on the treatment.</li>
<li>Assumptions:
<ol>
<li><strong>Relevance</strong>: the instrumental variable is correlated with the treatment.</li>
<li><strong>Exogeneity</strong>: the instrumental variable is independent of the unobserved confounders.</li>
<li><strong>Exclusion Restriction</strong>: the instrumental variable affects the outcome only through the treatment.</li>
</ol>
</li>
<li>Steps:
<ol>
<li>Estimate the first-stage regression: $A = \alpha_0 + \alpha_1 Z + \epsilon_1$.</li>
<li>Estimate the second-stage regression: $Y = \beta_0 + \beta_1 \hat{A} + \epsilon_2$.</li>
<li>Calculate the average treatment effect, $ATE = \hat{\beta_1}$.</li>
</ol>
</li>
</ul>
<p>So far, we have discussed the major methods for estimating the causal effect from observational data. Each method has its
own assumptions and limitations, there is no clear winner and the choice of method depends on the specific context and
data characteristics. In practice, it is often recommended to use multiple methods to estimate the causal effect and
compare the results to ensure the robustness of the conclusions.</p>
<h2 id="root-cause-optimization" >
<div>
    <a href="#root-cause-optimization">
        #
    </a>
    Root Cause Optimization
</div>
</h2>
<p>In the above sections, we designed a hypothetical causality problem of estimating the effect of taking a new drug. The
treatment variable $A$ can be defined as $A_i = 1$ if the patient takes the new drug and $A_i = 0$ if the patient does not.
More generally, the treatment variable can be formulated in this way $A = 1_{{f(\theta) &lt; \mu}}$, where $f(\theta)$ is
the function that maps the treatment parameters $\theta$ to the treatment assignment, and $\mu$ is the threshold that
determines the treatment assignment. $f(\theta)$ is often a known metric since causal inference usually starts with some
suspected causal mechanisms. However, the threshold $\mu$ is often unknown and needs to be optimized to maximize the
causal effect. Therefore, the root cause optimization is to find the optimal threshold $\mu$ that maximizes the causal
effect.</p>
<p align="center">
$argmax_{\mu} E[Y^{A=1}] - E[Y^{A=0}]$, 
where $A = 1_{\{f(\theta) < \mu\}}$ with given $f(\theta)$
<p>
<p>To solve the optimization problem, we can use the causal inference methods discussed above to estimate the causal effect
under different thresholds and find the optimal threshold that maximizes the causal effect. Popular optimization algorithms
such as grid search, random search and bayesian optimization can be used to find the optimal threshold.</p>
<h2 id="appendix" >
<div>
    <a href="#appendix">
        #
    </a>
    Appendix
</div>
</h2>
<h3 id="do-calculus" >
<div>
    <a href="#do-calculus">
        ##
    </a>
    Do Calculus
</div>
</h3>
<p>While we formulate the causal effect from the counterfactual perspective, there is another powerful tool that called
do-calculus that estimates the causal effect by setting interventions on the treatment variable. In particular, it&rsquo;s
trying to apply interventions $A=a$ to the causal graph that deletes the edges pointing to $A$, and then conditioning on
the observed variables to estimate the causal effect. The average treatment effect can be written as:</p>
<p align="center">
$ATE = E[Y^{a=1}] - E[Y^{a=0}] = E[Y|do(A=1)] - E[Y|do(A=0)]$
<p>
<p>Please refer to the do-calculus literature<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> for more details.</p>
<h2 id="citation" >
<div>
    <a href="#citation">
        #
    </a>
    Citation
</div>
</h2>
<p>If you find this post helpful, please consider citing it as:</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bibtex" data-lang="bibtex"><span style="display:flex;"><span><span style="color:#f3f99d">@article</span>{<span style="color:#ff5c57">wang2024causality</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#57c7ff">author</span> = <span style="color:#5af78e">&#34;Bing Wang&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#57c7ff">title</span> = <span style="color:#5af78e">&#34;Causality Introduction&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#57c7ff">journal</span> = <span style="color:#5af78e">&#34;bingzw.github.io&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#57c7ff">year</span> = <span style="color:#5af78e">&#34;2024&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#57c7ff">month</span> = <span style="color:#5af78e">&#34;May&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#57c7ff">url</span> = <span style="color:#5af78e">&#34;https://bingzw.github.io/posts/2024-05-28-causality/&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>or</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>Bing Wang. (2024, May). Causality Introduction. 
</span></span><span style="display:flex;"><span>https://bingzw.github.io/posts/2024-05-28-causality/
</span></span></code></pre></div><h2 id="reference" >
<div>
    <a href="#reference">
        #
    </a>
    Reference
</div>
</h2>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://www.youtube.com/watch?v=Od6oAz1Op2k">Causal Inference: Explained</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/">Hernán MA, Robins JM (2020). Causal Inference: What If. Boca Raton: Chapman &amp; Hall/CRC.</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Pearl, Judea (2000). Causality: Models, Reasoning, and Inference.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
        </div>

    </article>

    
    
        
    

    
        
        
    

    

    
        








            

<script>
        function detectCurrentScheme2() {
                const defaultTheme = "auto";
                if (localStorage !== null && localStorage.getItem("user-color-scheme")) {
                        return localStorage.getItem("user-color-scheme");
                }
                if (defaultTheme === "dark" || defaultTheme === "light") {
                        return defaultTheme;
                }
                return window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
        }

        let giscusTheme = detectCurrentScheme2();
        let giscusAttributes = {
                src: "https://giscus.app/client.js",
                "data-repo": "Bingzw\/bingzw.github.io",
                "data-repo-id": "R_kgDOMB8LQg",
                "data-category": "Announcements",
                "data-category-id": "DIC_kwDOMB8LQs4CfrMr",
                "data-mapping": "pathname",
                "data-strict": "0",
                "data-reactions-enabled": "1",
                "data-emit-metadata": "0",
                "data-input-position": "bottom",
                "data-theme": giscusTheme,
                "data-lang": "en",
                crossorigin: "anonymous",
                lazyload: "false",
                async: true,
        };
        let main = document.querySelector("main");
        let giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
        main.appendChild(giscusScript);
</script>




    

    

    

        </main>
        
            <footer class="common-footer noselect">
    
    

    <div class="common-footer-bottom">
        

        <div style="display: flex; align-items: center; gap:8px">
            © Bing Wang, 2024
            
        </div>
        <div style="display:flex;align-items: center">
            
            
            
            
            
            
        </div>
        <div>
            Powered by <a target="_blank" rel="noopener noreferrer" href="https://gohugo.io/">Hugo</a>, theme <a target="_blank" rel="noopener noreferrer" href="https://github.com/Junyi-99/hugo-theme-anubis2">Anubis2</a>.<br>
            

        </div>
    </div>

    <p class="h-card vcard">

    <a href=https://bingzw.github.io/ class="p-name u-url url fn" rel="me"></a>

    

    
</p>

</footer>

        
    </div>
</body>
</html>
